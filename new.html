<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <title>Desenvolvedor web e mobile com conhecimento em designer de interface</title>
    
</head>

<style>
    html {
        font-family: sans-serif;
    }
    .block {
        margin: 5px;
        padding: 20px;
        width: 615px;
        vertical-align: top;
        background: #EEE;
    }

    #bio {
        white-space: pre-wrap;
    }
    #designs {
        overflow: hidden;
        overflow-x: auto;
        height: 170px;
        white-space: nowrap;
    }
    #designs img {
        height: 150px;
    }
</style>

<body>
    <div id="bio" class="block"></div>
    <div id="designs" class="block"></div>
    <div id="slides" class="block"></div>
    <div id="projects" class="block"></div>
    <div id="codes" class="block"></div>
</body>

<script type="text/html" id="projects_template">
    <ul>
        <% for (i in projects) { %>
            <li><a href="<%= projects[i].link %>"><%= projects[i].name %></a> - <%= projects[i].description %></li>
        <% } %>
    </ul>
</script>

<script type="text/html" id="codes_template">
    <ul>
        <% for (i in codes) { %>
            <li><a href="<%= codes[i].link %>"><%= codes[i].description %></a></li>
        <% } %>
    </ul>
</script>

<script type="text/html" id="designs_template">
    <% for (i in designs) { %>
        <a href="<%= designs[i].image %>"><img src="<%= designs[i].thumb %>" title="<%= designs[i].description %>"></a>
    <% } %>
</script>

<script src="http://code.jquery.com/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script>
// Simple JavaScript Templating
// John Resig - http://ejohn.org/ - MIT Licensed
(function(){
  var cache = {};
  
  this.tmpl = function tmpl(str, data){
    var fn = !/\W/.test(str) ?
      cache[str] = cache[str] ||
        tmpl(document.getElementById(str).innerHTML) :
      
      new Function("obj",
        "var p=[],print=function(){p.push.apply(p,arguments);};" +
        "with(obj){p.push('" +
        str
          .replace(/[\r\t\n]/g, " ")
          .split("<%").join("\t")
          .replace(/((^|%>)[^\t]*)'/g, "$1\r")
          .replace(/\t=(.*?)%>/g, "',$1,'")
          .split("\t").join("');")
          .split("%>").join("p.push('")
          .split("\r").join("\\'")
      + "');}return p.join('');");
  
  return data ? fn( data ) : fn;
  };
})();
</script>
<script>
    function View(model) {
        this.renderPhoto = function() {
            var avatar = $("<img>").attr("src", model.avatar);

            $("#bio").prepend(avatar);
        }

        this.renderBio = function() {
            $("#bio").append(model.name + "<br>")
                     .append(model.bio);
        }

        this.renderSlides = function() {
            $("#slides").append(model.slideshow);
        }

        this.renderCodes = function() {
            $("#codes").append(tmpl("codes_template", model));
        }

        this.renderProjects = function() {
            $("#projects").append(tmpl("projects_template", model));
        }
        
        this.renderDesigns = function() {
            $("#designs").prepend(tmpl("designs_template", model));
        }
    }

    function Profile(data) {
        var self = this;
        var githubId = "5814e822e2c279be6ef4";
        var githubSecret = "d118f66ea06b329581e4f805b23db32ad9bad70c";

        self.fetchGithubRepos = function(callback) {
            $.getJSON("https://api.github.com/users/" + data.github + "/repos?client_id=" + githubId + "&client_secret=" + githubSecret, function(resp) {
                data.gravatar = resp[0].owner.gravatar_id;

                self.projects = [];
                
                for (i in resp) {
                    self.projects.push({
                        name: resp[i].name,
                        description: resp[i].description,
                        link: resp[i].html_url,
                    });
                }

                callback();
            });

            return self;
        };

        self.fetchGists = function(callback) {
            $.getJSON("https://api.github.com/users/" + data.github + "/gists", function(resp) {
                self.codes = [];

                for (i in resp) {
                    self.codes.push({
                        description: resp[i].description,
                        link: resp[i].html_url,
                    });
                }

                callback();
            });
            
            return self;
        };

        self.fetchGravatar = function(callback) {
            $.getJSON("http://www.gravatar.com/" + data.gravatar + ".json?callback=?", function(resp) {
                self.name = resp.entry[0].displayName;
                self.bio = resp.entry[0].aboutMe;
                self.avatar = resp.entry[0].thumbnailUrl + "?size=150";

                callback();
            });

            return self;
        };

        self.fetchSlideshare = function(callback) {
            self.slideshow = $('<iframe frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:none;" allowfullscreen webkitallowfullscreen mozallowfullscreen>').attr("src", "http://www.slideshare.net/" + data.slideshare + "/slideshelf")
                         .attr("width", "615px")
                         .attr("height", "470px");

            callback();
            
            return self;
        };

        self.fetchFlickr = function(callback) {
            $.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?id=" + data.flickr + "&lang=pt-br&tags=portfolio&format=json&jsoncallback=?", function(resp) {
                self.designs = [];
                var items = resp.items;

                for (i in items) {
                    self.designs.push({
                        thumb: items[i].media.m,
                        image: items[i].media.m.replace("_m.", "."),
                        link: items[i].link,
                        description: items[i].title,
                    });
                }

                callback();
            });

            return self;
        };
    }

    var me = new Profile({
        github: "henriquegogo",
        slideshare: "henriquegogo",
        flickr: "34052227@N06"
    });

    var view = new View(me);

    me.fetchGithubRepos(function() {
        view.renderProjects();

        me.fetchGravatar(function() {
            view.renderPhoto();
            view.renderBio();
        });

    }).fetchGists(function() {
        view.renderCodes();
        
    }).fetchSlideshare(function() {
        view.renderSlides();
        
    }).fetchFlickr(function() {
        view.renderDesigns();
    });
</script>
</html>
